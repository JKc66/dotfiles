#!/bin/bash
# 90-custom-info - Split Layout (Logo Left, Info Right)

# Colors (ANSI-C Quoting for reliability)
GREEN=$'\033[1;32m'
BLUE=$'\033[1;34m'
CYAN=$'\033[1;36m'
YELLOW=$'\033[1;33m'
RED=$'\033[1;31m'
WHITE=$'\033[1;37m'
MAGENTA=$'\033[1;35m'
GRAY=$'\033[1;30m'
NC=$'\033[0m'

# â”€â”€â”€ GATHER INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HOSTNAME=$(hostname)
IP=$(hostname -I | awk '{print $1}')
# OS Name
OS_NAME=$(grep PRETTY_NAME /etc/os-release | cut -d'"' -f2)
[ -z "$OS_NAME" ] && OS_NAME=$(grep NAME /etc/os-release | head -1 | cut -d'"' -f2)

# Load
LOAD_VAL=$(awk '{print $1}' /proc/loadavg)
CORES=$(nproc)
LOAD_PCT=$(awk "BEGIN {printf \"%.0f\", ($LOAD_VAL / $CORES) * 100}")

# Uptime
UPTIME_SEC=$(awk '{print int($1)}' /proc/uptime)
DAYS=$((UPTIME_SEC / 86400))
HOURS=$(( (UPTIME_SEC % 86400) / 3600 ))
MINS=$(( (UPTIME_SEC % 3600) / 60 ))
if [ "$DAYS" -gt 0 ]; then
    UPTIME="${DAYS}d ${HOURS}h ${MINS}m"
else
    UPTIME="${HOURS}h ${MINS}m"
fi

# Memory
MEM_TOTAL_KB=$(grep MemTotal /proc/meminfo | awk '{print $2}')
MEM_AVAIL_KB=$(grep MemAvailable /proc/meminfo | awk '{print $2}')
MEM_USED_KB=$((MEM_TOTAL_KB - MEM_AVAIL_KB))
MEM_TOTAL_GB=$(awk "BEGIN {printf \"%.1f\", $MEM_TOTAL_KB/1048576}")
MEM_USED_GB=$(awk "BEGIN {printf \"%.1f\", $MEM_USED_KB/1048576}")
MEM_PCT=$(awk "BEGIN {printf \"%.0f\", ($MEM_USED_KB / $MEM_TOTAL_KB) * 100}")

# Disk
DISK_USED=$(df -h / | awk 'NR==2 {print $3}')
DISK_TOTAL=$(df -h / | awk 'NR==2 {print $2}')
DISK_PCT=$(df -h / | awk 'NR==2 {gsub(/%/,""); print $5}')
DISK_FREE=$(df -h / | awk 'NR==2 {print $4}')

# Updates
UPDATES=""
if [ -f /var/lib/update-notifier/updates-available ]; then
    UPDATES=$(grep -oP '\d+' /var/lib/update-notifier/updates-available 2>/dev/null | head -1)
fi

# â”€â”€â”€ BAR GENERATORS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# âš¡ LOAD â€” Rising Signal Bars (climbs like CPU intensity)
make_load_bar() {
    local pct=$1
    local width=$2
    local filled=$(( (pct * width + 50) / 100 ))
    if [ "$pct" -gt 0 ] && [ "$filled" -eq 0 ]; then filled=1; fi
    if [ "$filled" -gt "$width" ]; then filled=$width; fi
    local empty=$(( width - filled ))

    local color="${GREEN}"
    [ "$pct" -gt 70 ] && color="${YELLOW}"
    [ "$pct" -gt 90 ] && color="${RED}"

    local heights=("â–‚" "â–ƒ" "â–…" "â–†" "â–ˆ")
    local bar="${color}"
    for ((i=0; i<filled; i++)); do
        if [ $i -lt ${#heights[@]} ]; then
            bar+="${heights[$i]}"
        else
            bar+="â–ˆ"
        fi
    done
    bar+="${GRAY}"
    for ((i=0; i<empty; i++)); do bar+="â–‘"; done
    bar+="${NC}"
    echo "$bar"
}

# ðŸ§  MEMORY â€” Braille Dot Matrix (dense dots = used RAM cells)
make_mem_bar() {
    local pct=$1
    local width=$2
    local filled=$(( (pct * width + 50) / 100 ))
    if [ "$pct" -gt 0 ] && [ "$filled" -eq 0 ]; then filled=1; fi
    if [ "$filled" -gt "$width" ]; then filled=$width; fi
    local empty=$(( width - filled ))

    local color="${GREEN}"
    [ "$pct" -gt 70 ] && color="${YELLOW}"
    [ "$pct" -gt 90 ] && color="${RED}"

    local bar="${color}"
    for ((i=0; i<filled; i++)); do bar+="â£¿"; done
    bar+="${GRAY}"
    for ((i=0; i<empty; i++)); do bar+="â£€"; done
    bar+="${NC}"
    echo "$bar"
}

# ðŸ’¾ DISK â€” Circle Dots (filled/hollow storage indicators)
make_disk_bar() {
    local pct=$1
    local width=$2
    local filled=$(( (pct * width + 50) / 100 ))
    if [ "$pct" -gt 0 ] && [ "$filled" -eq 0 ]; then filled=1; fi
    if [ "$filled" -gt "$width" ]; then filled=$width; fi
    local empty=$(( width - filled ))

    local color="${GREEN}"
    [ "$pct" -gt 70 ] && color="${YELLOW}"
    [ "$pct" -gt 90 ] && color="${RED}"

    local bar="${color}"
    for ((i=0; i<filled; i++)); do bar+="â—"; done
    bar+="${GRAY}"
    for ((i=0; i<empty; i++)); do bar+="â—‹"; done
    bar+="${NC}"
    echo "$bar"
}

L_BAR=$(make_load_bar $LOAD_PCT 5)
M_BAR=$(make_mem_bar $MEM_PCT 10)
D_BAR=$(make_disk_bar $DISK_PCT 10)

# â”€â”€â”€ LOGO & LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo ""
# Line 1
echo "${BLUE}      â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—${NC}   ${GREEN}Jawad Khan's Ubuntu AArch64 VM${NC}"
# Line 2
echo "${BLUE}      â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•${NC}   ${WHITE}OS:${NC}   $OS_NAME"
# Line 3
echo "${CYAN}      â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• ${NC}   ${WHITE}Host:${NC} $HOSTNAME  ${GRAY}â€¢${NC}  ${WHITE}IP:${NC} $IP"
# Line 4
echo "${CYAN} â–ˆâ–ˆ   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— ${NC}   ${WHITE}Up:${NC}   $UPTIME    ${GRAY}â€¢${NC}  ${WHITE}Load:${NC} $LOAD_VAL $L_BAR"
# Line 5
echo "${GREEN} â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—${NC}   ${WHITE}Mem:${NC}  ${MEM_USED_GB}G/${MEM_TOTAL_GB}G ${GRAY}($MEM_PCT%)${NC} $M_BAR"
# Line 6
echo "${GREEN}  â•šâ•â•â•â•â• â•šâ•â•  â•šâ•â•${NC}   ${WHITE}Disk:${NC} ${DISK_USED}/${DISK_TOTAL} ${GRAY}($DISK_PCT%)${NC} ${GREEN}${DISK_FREE} free${NC} $D_BAR"

if [ -n "$UPDATES" ]; then
    echo "                         ${YELLOW}ðŸ“¦ ${UPDATES} updates available!${NC}"
fi
